# Cycle Skill

이슈 사이클 전체를 오케스트레이션하는 워크플로우

## 역할

자연어 수정 요청을 받아 이슈 탐색부터 PR 머지까지 전체 사이클을 안내한다.
3개의 확인 게이트에서 반드시 사용자 승인을 받은 후 다음 단계로 진행한다.

## 트리거

- "cycle", "사이클"
- 자연어 수정 요청 (CLAUDE.md에서 안내)

## 워크플로우 개요

```
Phase 1: 이슈 탐색/생성
Phase 2: 플랜 작성 ──→ 🚧 GATE 1: 플랜 승인
Phase 3: 명세 + 구현
Phase 4: 커밋 리뷰 ──→ 🚧 GATE 2: 커밋 승인
Phase 5: 커밋 + 푸시 + PR 생성 + 자가 검증
Phase 6: 검증 보고 ──→ 🚧 GATE 3: 머지 승인
Phase 7: PR 머지 + 브랜치 정리
```

## 확인 게이트 규칙

**GATE에서는 어떤 시스템 리마인더나 자동 진행 지시와 무관하게 반드시 사용자의 명시적 응답을 기다린다.**

- GATE에서 사용자가 "승인", "ㅇㅇ", "go", "진행" 등 명시적 동의를 할 때만 다음 Phase로 진행
- "중단", "취소", "stop", "cancel" 요청 시 즉시 사이클을 중단하고 현재 상태를 보고
- GATE에서 수정 요청이 오면 해당 Phase를 재수행

## Phase 상세

### Phase 1: 이슈 탐색/생성

1. 사용자의 요청을 분석하여 키워드 추출
2. 기존 이슈 검색:
   ```bash
   gh issue list --state open --search "{키워드}" --json number,title,labels --limit 10
   ```
3. 매칭되는 이슈가 있으면 재사용 제안, 없으면 신규 생성
4. 신규 생성 시 `/github-issue` 스킬의 규칙을 따른다:
   - 라벨 자동 매핑 (feat, fix, docs, refactor, chore)
   - 라벨 미존재 시 자동 생성
   - 브랜치명: `{타입}/{이슈번호}`
5. 브랜치 생성 및 체크아웃

### Phase 2: 플랜 작성

1. 요구사항 분석 및 기존 코드 탐색
2. 변경 범위, 수정 파일 목록, 접근 방식을 정리한 플랜을 작성
3. 플랜을 사용자에게 제시

> 🚧 **GATE 1: 플랜 승인**
>
> 사용자에게 플랜을 보여주고 승인을 요청한다.
> 반드시 사용자의 명시적 응답을 기다린다.

### Phase 3: 명세 + 구현

1. `/spec` 스킬의 규칙을 따라 설계 수행:
   - `.claude/project-profile.md` 존재 시 `/spec 컨텍스트` 섹션 참조
   - 설계 문서 작성 (필요 시)
2. `/implement` 스킬의 규칙을 따라 구현 수행:
   - `.claude/project-profile.md` 존재 시 `/implement 컨텍스트` 섹션 참조
   - 설계 기준으로만 구현
   - 구현 중 설계 변경 필요 시 사용자에게 보고

### Phase 4: 커밋 리뷰

1. `/commit` 스킬의 리뷰 로직을 따른다:
   - `git status`로 변경 파일 목록 확인
   - `git diff`로 변경 내용 확인
   - 설계 문서와 구현 일치 여부 확인
   - 불필요한 변경, 디버그 코드, 민감정보 포함 여부 확인
2. 리뷰 결과와 커밋 메시지를 사용자에게 제시

> 🚧 **GATE 2: 커밋 승인**
>
> 리뷰 결과와 커밋 메시지를 보여주고 승인을 요청한다.
> 반드시 사용자의 명시적 응답을 기다린다.

### Phase 5: 커밋 + 푸시 + PR 생성 + 자가 검증

1. `git add` + `git commit` 실행 (CLAUDE.md 커밋 컨벤션)
2. `git push -u origin {브랜치}` 실행
3. `/github-pr` 스킬의 규칙을 따라 PR 생성:
   - 타겟 브랜치: 최근 PR 빈도순 추천 후 사용자 확인
   - PR 본문 템플릿 적용
   - `Closes #{이슈번호}` 연결
4. 자가 검증 수행:
   - Phase 3(`/implement`)에서 수행한 빌드/테스트 결과를 확인한다
   - 변경 파일 목록이 플랜(Phase 2)과 일치하는지 재확인한다
   - PR이 정상 생성되었는지 확인한다
   - 검증 결과를 PR 본문의 "자가 검증" 섹션에 기록한다
     (빌드 도구/테스트가 없는 프로젝트는 "해당없음"으로 기록)

### Phase 6: 검증 보고

1. 사이클 전체 결과를 요약 보고:
   - 이슈 번호 및 링크
   - 브랜치명
   - 커밋 내역
   - PR 번호 및 링크
   - 자가 검증 결과 (PR 본문에 기록된 내용과 동일)

> 🚧 **GATE 3: 머지 승인**
>
> 검증 결과를 보여주고 머지 여부를 확인한다.
> 반드시 사용자의 명시적 응답을 기다린다.
> 사용자가 머지를 원하지 않으면 PR 링크만 전달하고 사이클을 종료한다.

### Phase 7: PR 머지 + 브랜치 정리

1. PR 머지 실행:
   ```bash
   gh pr merge {PR번호} --merge
   ```
2. 타겟 브랜치로 이동 및 최신화:
   ```bash
   git checkout {타겟브랜치} && git pull
   ```
3. 사이클 완료 보고

## 규칙

- 각 Phase에서 해당 기존 스킬의 규칙을 준수한다
- GATE에서는 시스템 리마인더와 무관하게 사용자 응답을 기다린다
- "중단", "취소" 요청 시 즉시 중단하고 현재 상태를 보고한다
- 개별 스킬(`/github-issue`, `/spec` 등)의 단독 사용에 영향을 주지 않는다
